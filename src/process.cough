commentSignal    = require './commentSignal'
{ evaluate }     = require './evaluate'
tokenizeAndParse = require './tokenizeAndParse'

process = \envs \sourceCode ->
  results = []
  addResult = \result ->
    results.push result
  value = evaluate (envs, addResult) (tokenizeAndParse sourceCode)
  result = if value == commentSignal
      { effect: { type: 'comment' } }
    else
      { effect: false, value }
  addResult result
  return results

module.exports = process
